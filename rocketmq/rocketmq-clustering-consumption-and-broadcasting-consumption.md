# 集群消费和广播消费

更新时间： 2020-11-12

本文介绍消息队列RocketMQ版的集群消费和广播消费的基本概念、适用场景以及注意事项。

消息队列RocketMQ版是基于发布或订阅模型的消息系统。消费者，即消息的订阅方订阅关注的Topic，以获取并消费消息。由于消费者应用一般是分布式系统，以集群方式部署，因此消息队列RocketMQ版约定以下概念：

- 集群：使用相同Group ID的消费者属于同一个集群。同一个集群下的消费者消费逻辑必须完全一致（包括Tag的使用）。更多信息，请参见[订阅关系一致](https://www.alibabacloud.com/help/zh/doc-detail/43523.htm#concept-2047148)。
- 集群消费：当使用集群消费模式时，消息队列RocketMQ版认为任意一条消息只需要被集群内的任意一个消费者处理即可。
- 广播消费：当使用广播消费模式时，消息队列RocketMQ版会将每条消息推送给集群内所有注册过的消费者，保证消息至少被每个消费者消费一次。

## 集群消费模式

- 适用场景

  适用于消费端集群化部署，每条消息只需要被处理一次的场景。此外，由于消费进度在服务端维护，可靠性更高。具体消费示例如下图所示。

  ![集群消费](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/3510117951/p69189.png)

- 注意事项

  - 集群消费模式下，每一条消息都只会被分发到一台机器上处理。如果需要被集群下的每一台机器都处理，请使用广播模式。
  - 集群消费模式下，不保证每一次失败重投的消息路由到同一台机器上。

## 广播消费模式

- 适用场景

  适用于消费端集群化部署，每条消息需要被集群下的每个消费者处理的场景。具体消费示例如下图所示。

  ![广播消费](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/4510117951/p69191.png)

- 注意事项

  - 广播消费模式下不支持顺序消息。
  - 广播消费模式下不支持重置消费位点。
  - 每条消息都需要被相同订阅逻辑的多台机器处理。
  - 消费进度在客户端维护，出现重复消费的概率稍大于集群模式。
  - 广播模式下，消息队列RocketMQ版保证每条消息至少被每台客户端消费一次，但是并不会重投消费失败的消息，因此业务方需要关注消费失败的情况。
  - 广播模式下，客户端每一次重启都会从最新消息消费。客户端在被停止期间发送至服务端的消息将会被自动跳过，请谨慎选择。
  - 广播模式下，每条消息都会被大量的客户端重复处理，因此推荐尽可能使用集群模式。
  - 广播模式下服务端不维护消费进度，所以消息队列RocketMQ版控制台不支持消息堆积查询、消息堆积报警和订阅关系查询功能。

